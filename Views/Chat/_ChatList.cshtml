@model List<KLTN.Models.ConversationViewModel>

@{
    var currentUserId = ViewBag.CurrentUserId;
}

<link rel="stylesheet" href="~/css/iziToast.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/izitoast/1.4.0/js/iziToast.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/izitoast/1.4.0/css/iziToast.min.css">
<script src="~/js/Chat/chatList.js"></script>

<style>
    .chat-list {
        list-style: none;
        padding: 0;
    }

    .chat-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        border-bottom: 1px solid #ddd;
        cursor: pointer;
    }

    .chat-item:hover {
        background-color: #f1f1f1;
    }

    .chat-meta {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .chat-time {
        margin-top: 25px;
        font-size: 12px;
        color: gray;
        white-space: nowrap;
    }

    .delete-btn {
        background-color: red;
        color: white;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
    }

    .delete-btn:hover {
        background-color: darkred;
    }

    .unread {
        font-weight: bold;
    }
</style>

<div class="chatbox-body">
    @if (Model.Any())
    {
        <ul class="chat-list">
            @foreach (var conversation in Model)
            {
                var lastSenderName = conversation.LastSenderId == currentUserId ? "Bạn" : conversation.LastSenderName;

                <li class="chat-item @(conversation.HasUnreadMessages ? "unread" : "")" onclick="openChat('@conversation.ConversationId')">
                    <div class="chat-user">
                        <strong>@conversation.UserName</strong> (@(conversation.HasUnreadMessages ? "Có tin chưa đọc" : "Đã đọc"))
                        <br />
                        <small class="last-message @(conversation.HasUnreadMessages ? "unread" : "")">
                            <b>@lastSenderName:</b> @conversation.LastMessage
                        </small>
                    </div>
                    <div class="chat-meta">
                        <small class="chat-time">
                            @(conversation.LastMessageTime?.ToString("HH:mm dd/MM") ?? "")
                        </small>
                        <button class="delete-btn" onclick="deleteConversation(event, '@conversation.ConversationId')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </li>
            }
        </ul>
    }
    else
    {
        <p class="no-messages">Không có cuộc trò chuyện nào.</p>
    }
</div>

