@model IEnumerable<KLTN.Models.Report>

<head>
    <link rel="stylesheet" href="~/css/iziToast.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/izitoast/dist/css/iziToast.min.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/izitoast/dist/js/iziToast.min.js"></script>

    <style>
        th, td {
            text-align: center;
            padding: 10px;
            border: 1px solid #ddd;
            word-wrap: break-word; /* ƒê·∫£m b·∫£o ch·ªØ kh√¥ng b·ªã tr√†n ra ngo√†i */
        }

        td:last-child {
            display: flex;
            gap: 5px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .house-link {
            text-decoration: none;
            color: #007bff; /* Thay ƒë·ªïi m√†u s·∫Øc c·ªßa li√™n k·∫øt */
            font-weight: bold; /* ƒê·∫≠m vƒÉn b·∫£n */
        }

        .house-link:hover {
            color: #0056b3; /* Thay ƒë·ªïi m√†u khi hover */
        }

        #searchInput {
            margin-top: 20px;
            min-width: 400px; 
        }
    </style>
</head>

<body>
    <h3 class="text-center mt-3">Danh s√°ch b√°o c√°o b√†i ƒëƒÉng</h3>

    <div class="row mb-3">
        <div class="col-12 col-md-4">
            <input type="text" id="searchInput" class="form-control" placeholder="üîç T√¨m ki·∫øm b√°o x·∫•u...">
        </div>
    </div>

    <table class="table table-bordered table-hover">
        <thead>
            <tr>
                <th>ID</th>
                <th>Ti√™u ƒë·ªÅ b√†i ƒëƒÉng</th>
                <th>Ng∆∞·ªùi b√°o c√°o</th>
                <th>L√Ω do</th>
                <th>Ng√†y b√°o c√°o</th>
                <th>Tr·∫°ng th√°i</th>
                <th>H√†nh ƒë·ªông</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr id="row-@item.Id">
                    <td>@item.Id</td>
                    <td>
                        <a href="@Url.Action("Detail", "Home", new { id = item.HouseId })" class="house-link">
                            @item.House?.NameHouse
                        </a>
                    </td>
                    <td>@item.User?.UserName</td>
                    <td>@item.Reason</td>
                    <td>@item.CreatedAt.ToString("dd/MM/yyyy HH:mm")</td>
                    <td class="status">
                        @if (item.IsApproved)
                        {
                            <span class="badge bg-success">ƒê√£ duy·ªát</span>
                        }
                        else
                        {
                            <span class="badge bg-warning text-dark">Ch∆∞a duy·ªát</span>
                        }
                    </td>
                    <td>
                        @if (!item.IsApproved)
                        {
                            <button class="btn btn-sm btn-success approve-btn" data-id="@item.Id">
                                <i class="fas fa-check"></i> Duy·ªát
                            </button>
                            <button class="btn btn-sm btn-danger reject-btn" data-id="@item.Id">
                                <i class="fas fa-times"></i> T·ª´ ch·ªëi
                            </button>
                        }
                        else
                        {
                            <em>Kh√¥ng kh·∫£ d·ª•ng</em>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <script>
        $(document).ready(function () {
            $('.approve-btn').click(function () {
                const id = $(this).data('id');

                $.post('@Url.Action("DuyetBaoCao", "Admin")', { id: id }, function (res) {
                    if (res.success) {
                        iziToast.success({ title: 'Th√†nh c√¥ng', message: 'B√°o c√°o ƒë√£ ƒë∆∞·ª£c duy·ªát.', position: 'topRight' });

                        const row = $(`#row-${id}`);
                        row.find('.status').html('<span class="badge bg-success">ƒê√£ duy·ªát</span>');
                        row.find('td:last-child').html('<em>Kh√¥ng kh·∫£ d·ª•ng</em>');
                    } else {
                        iziToast.error({ title: 'L·ªói', message: res.message, position: 'topRight' });
                    }
                }).fail(() => {
                    iziToast.error({ title: 'L·ªói', message: 'Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn m√°y ch·ªß.', position: 'topRight' });
                });
            });

            $('.reject-btn').click(function () {
                const id = $(this).data('id');

                $.post('@Url.Action("TuChoiBaoCao", "Admin")', { id: id }, function (res) {
                    if (res.success) {
                        iziToast.success({ title: 'Th√†nh c√¥ng', message: 'ƒê√£ t·ª´ ch·ªëi v√† x√≥a b√°o c√°o.', position: 'topRight' });

                        $(`#row-${id}`).fadeOut(300, function () { $(this).remove(); });
                    } else {
                        iziToast.error({ title: 'L·ªói', message: res.message, position: 'topRight' });
                    }
                }).fail(() => {
                    iziToast.error({ title: 'L·ªói', message: 'Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn m√°y ch·ªß.', position: 'topRight' });
                });
            });

            // T√¨m ki·∫øm 
            $("#searchInput").on("keyup", function () {
                const value = $(this).val().toLowerCase();
                $("table tbody tr").filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
                });
            });
        });
    </script>
</body>