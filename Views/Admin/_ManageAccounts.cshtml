@model IEnumerable<KLTN.Models.Account>

<h3 class="text-center mt-3">Qu·∫£n l√Ω t√†i kho·∫£n</h3>

<link rel="stylesheet" href="~/css/iziToast.css">

<table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>ID</th>
            <th>T√™n ng∆∞·ªùi d√πng</th>
            <th>S·ªë ƒëi·ªán tho·∫°i</th>
            <th>Email</th>
            <th>Vai tr√≤</th>
            <th>Tr·∫°ng th√°i</th>
            <th>H√†nh ƒë·ªông</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var account in Model)
        {
            <tr>
                <td>@account.IdUser</td>
                <td>@account.UserName</td>
                <td>@account.PhoneNumber</td>
                <td>@account.Email</td>
                <td>
                    @switch (account.Role)
                    {
                        case 0:
                            @:Admin
                            break;
                        case 1:
                            @:Ch·ªß tr·ªç
                            break;
                        default:
                            @:Ng∆∞·ªùi t√¨m ph√≤ng
                            break;
                    }
                </td>
                <td>
                    @if (account.IsLocked)
                    {
                        <span class="badge badge-danger">B·ªã kho√°</span>
                    }
                    else
                    {
                        <span class="badge badge-success">Ho·∫°t ƒë·ªông</span>
                    }
                </td>
                <td>
                    <a href="@Url.Action("Details", "Admin", new { id = account.IdUser })" class="btn btn-sm btn-primary"
                        title="Xem chi ti·∫øt t√†i kho·∫£n">
                        <i class="fas fa-eye"></i>
                    </a>

                    <button class="btn btn-sm btn-danger delete-account" data-id="@account.IdUser" title="Xo√° t√†i kho·∫£n">
                        <i class="fas fa-trash-alt"></i>
                    </button>

                    @if (account.IsLocked)
                    {
                        <button class="btn btn-sm btn-success unlock-account" data-id="@account.IdUser"
                            title="M·ªü kho√° t√†i kho·∫£n">
                            <i class="fas fa-unlock"></i>
                        </button>
                    }
                    else
                    {
                        <button class="btn btn-sm btn-warning lock-account" data-id="@account.IdUser" title="Kho√° t√†i kho·∫£n">
                            <i class="fas fa-lock"></i>
                        </button>
                    }
                </td>
            </tr>
        }
    </tbody>
</table>

<!-- Th√™m th∆∞ vi·ªán iziToast -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/izitoast/1.4.0/js/iziToast.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/izitoast/1.4.0/css/iziToast.min.css" />

<script>
    $(document).ready(function () {
        // Xo√° t√†i kho·∫£n
        $(".delete-account").on("click", function () {
            const id = $(this).data("id");

            iziToast.question({
                class: 'iziToast-custom',
                title: "üîî X√°c nh·∫≠n xo√°",
                message: "B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën xo√° t√†i kho·∫£n n√†y kh√¥ng?",
                position: "center",
                timeout: false,
                close: false,
                overlay: true,
                icon: "fa fa-question-circle",
                buttons: [
                    ['<button><i class="fa fa-check"></i> <b>C√≥</b></button>', function (instance, toast) {
                        instance.hide({ transitionOut: 'fadeOut' }, toast, 'button');

                        $.post("@Url.Action("DeleteAccount", "Admin")", { id: id }, function (response) {
                            if (response.success) {
                                iziToast.success({
                                    title: 'Th√†nh c√¥ng!',
                                    message: 'Xo√° t√†i kho·∫£n th√†nh c√¥ng.',
                                    position: 'topRight',
                                    timeout: 1000,
                                });
                                $(`tr:has(button[data-id='${id}'])`).remove();
                            } else {
                                iziToast.error({
                                    title: "L·ªói",
                                    message: response.message,
                                    position: "topRight",
                                    timeout: 2000
                                });
                            }
                        }).fail(() => {
                            iziToast.error({
                                title: "L·ªói!",
                                message: "ƒê√£ x·∫£y ra l·ªói khi xo√° t√†i kho·∫£n.",
                                position: "topRight",
                                timeout: 3000
                            });
                        });

                    }, true],
                    ['<button><i class="fa fa-times"></i> H·ªßy</button>', function (instance, toast) {
                        instance.hide({ transitionOut: 'fadeOut' }, toast, 'button');
                    }]
                ]
            });
        });

        $(document).ready(function () {
            function bindEvents() {
                // X·ª≠ l√Ω kho√° t√†i kho·∫£n
                $(".lock-account").off("click").on("click", function () {
                    const id = $(this).data("id");
                    const button = $(this);

                    iziToast.question({
                        class: 'iziToast-custom',
                        title: "üîí X√°c nh·∫≠n kho√° t√†i kho·∫£n",
                        message: "B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën kho√° t√†i kho·∫£n n√†y kh√¥ng?",
                        position: "center",
                        timeout: false,
                        close: false,
                        overlay: true,
                        buttons: [
                            ['<button><i class="fa fa-lock"></i> Kho√°</button>', function (instance, toast) {
                                instance.hide({ transitionOut: 'fadeOut' }, toast, 'button');

                                $.post("@Url.Action("LockAccount", "Admin")", { id: id }, function (response) {
                                    if (response.success) {
                                        iziToast.success({
                                            title: "Th√†nh c√¥ng!",
                                            message: "T√†i kho·∫£n ƒë√£ b·ªã kho√°.",
                                            position: "topRight",
                                            timeout: 1000
                                        });

                                        // Chuy·ªÉn n√∫t "Kho√°" th√†nh "M·ªü kho√°"
                                        button.removeClass("btn-warning lock-account").addClass("btn-success unlock-account")
                                            .html('<i class="fas fa-unlock"></i>')
                                            .attr("title", "M·ªü kho√° t√†i kho·∫£n");

                                        // C·∫≠p nh·∫≠t tr·∫°ng th√°i hi·ªÉn th·ªã
                                        button.closest("tr").find("td:nth-child(6)").html('<span class="badge badge-danger">B·ªã kho√°</span>');

                                        // G√°n l·∫°i s·ª± ki·ªán
                                        bindEvents();
                                    }
                                });
                            }, true],
                            ['<button><i class="fa fa-times"></i> H·ªßy</button>', function (instance, toast) {
                                instance.hide({ transitionOut: 'fadeOut' }, toast, 'button');
                            }]
                        ]
                    });
                });

                // X·ª≠ l√Ω m·ªü kho√° t√†i kho·∫£n
                $(".unlock-account").off("click").on("click", function () {
                    const id = $(this).data("id");
                    const button = $(this);

                    iziToast.question({
                        class: 'iziToast-custom',
                        title: "üîì X√°c nh·∫≠n m·ªü kho√°",
                        message: "B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën m·ªü kho√° t√†i kho·∫£n n√†y kh√¥ng?",
                        position: "center",
                        timeout: false,
                        close: false,
                        overlay: true,
                        buttons: [
                            ['<button><i class="fa fa-unlock"></i> M·ªü kho√°</button>', function (instance, toast) {
                                instance.hide({ transitionOut: 'fadeOut' }, toast, 'button');

                                $.post("@Url.Action("UnlockAccount", "Admin")", { id: id }, function (response) {
                                    if (response.success) {
                                        iziToast.success({
                                            title: "Th√†nh c√¥ng!",
                                            message: "T√†i kho·∫£n ƒë√£ ƒë∆∞·ª£c m·ªü kho√°.",
                                            position: "topRight",
                                            timeout: 1000
                                        });

                                        // Chuy·ªÉn n√∫t "M·ªü kho√°" th√†nh "Kho√°"
                                        button.removeClass("btn-success unlock-account").addClass("btn-warning lock-account")
                                            .html('<i class="fas fa-lock"></i>')
                                            .attr("title", "Kho√° t√†i kho·∫£n");

                                        // C·∫≠p nh·∫≠t tr·∫°ng th√°i hi·ªÉn th·ªã
                                        button.closest("tr").find("td:nth-child(6)").html('<span class="badge badge-success">Ho·∫°t ƒë·ªông</span>');

                                        // G√°n l·∫°i s·ª± ki·ªán
                                        bindEvents();
                                    }
                                });
                            }, true],
                            ['<button><i class="fa fa-times"></i> H·ªßy</button>', function (instance, toast) {
                                instance.hide({ transitionOut: 'fadeOut' }, toast, 'button');
                            }]
                        ]
                    });
                });
            }
            // G√°n s·ª± ki·ªán l·∫ßn ƒë·∫ßu
            bindEvents();
        });
    });
</script>
