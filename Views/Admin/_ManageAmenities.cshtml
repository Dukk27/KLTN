@model IEnumerable<KLTN.Models.Amenity>

<link rel="stylesheet" href="~/css/iziToast.css">

<div class="container">
    <h3 class="text-center mt-3">Qu·∫£n l√Ω Ti·ªán Nghi</h3>
    <button class="btn btn-primary mb-2" onclick="openCreateModal()">
        <i class="fa fa-plus-circle"></i> Th√™m m·ªõi
    </button>

    <table class="table table-bordered">
        <thead>
            <tr>
                <th>ID</th>
                <th>T√™n Ti·ªán Nghi</th>
                <th>H√†nh ƒê·ªông</th>
            </tr>
        </thead>
        <tbody id="amenityTableBody">
            @{
                int index = 1;
            }
            @foreach (var amenity in Model)
            {
                <tr id="row_@amenity.IdAmenity">
                    <td>@index</td>
                    <td>@amenity.Name</td>
                    <td>
                        <button class="btn btn-warning btn-sm"
                            onclick="openEditModal(@amenity.IdAmenity, '@amenity.Name')" title="Ch·ªânh s·ª≠a ti·ªán nghi"><i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteAmenity(@amenity.IdAmenity)" title="Xo√° ti·ªán nghi"><i
                                class="fas fa-trash-alt"></i></button>
                    </td>
                </tr>
                index++;
            }
        </tbody>
    </table>
</div>

<!-- Modal ƒë·ªÉ th√™m/s·ª≠a ti·ªán nghi -->
<div id="amenityModal" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 id="modalTitle">Th√™m Ti·ªán Nghi</h5>
                <button type="button" class="close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="amenityId">
                <label>T√™n Ti·ªán Nghi:</label>
                <input type="text" id="amenityName" class="form-control">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success" onclick="saveAmenity()">L∆∞u</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal()">H·ªßy</button>
            </div>
        </div>
    </div>
</div>

<!-- Th√™m th∆∞ vi·ªán iziToast -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/izitoast/1.4.0/js/iziToast.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/izitoast/1.4.0/css/iziToast.min.css" />

<script>
    function openCreateModal() {
        $("#modalTitle").text("Th√™m Ti·ªán Nghi");
        $("#amenityId").val('');
        $("#amenityName").val('');
        $("#amenityModal").modal("show");
    }

    function openEditModal(id, name) {
        $("#modalTitle").text("S·ª≠a Ti·ªán Nghi");
        $("#amenityId").val(id);
        $("#amenityName").val(name);
        $("#amenityModal").modal("show");
    }

    function closeModal() {
        $("#amenityModal").modal("hide");
    }

    function saveAmenity() {
        let id = $("#amenityId").val();
        let name = $("#amenityName").val().trim();

        if (!name) {
            iziToast.warning({
                title: "L·ªói!",
                message: "T√™n ti·ªán nghi kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.",
                position: "topRight",
                timeout: 3000
            });
            return;
        }

        let url = id ? "/Admin/EditAmenity" : "/Admin/CreateAmenity";
        let data = JSON.stringify({ IdAmenity: id ? parseInt(id) : 0, Name: name });

        $.ajax({
            type: "POST",
            url: url,
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: data,
            success: function (response) {
                iziToast.show({
                    title: response.success ? "‚úÖ Th√†nh c√¥ng!" : "‚ùå L·ªói!",
                    message: response.message,
                    position: "topRight",
                    timeout: 1000,
                    color: response.success ? "green" : "red"
                });

                if (response.success) {
                    closeModal();
                    updateAmenityTable();
                }
            },
            error: function () {
                iziToast.error({
                    title: "L·ªói!",
                    message: "C√≥ l·ªói x·∫£y ra, vui l√≤ng th·ª≠ l·∫°i.",
                    position: "topRight",
                    timeout: 1000
                });
            }
        });
    }

    function deleteAmenity(id) {
        iziToast.show({
            class: "iziToast-custom",
            title: "üîî X√°c nh·∫≠n x√≥a",
            message: "B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!",
            position: "center",
            timeout: false,
            close: false,
            overlay: true,
            displayMode: "once",
            drag: false,
            icon: "fa fa-question-circle",
            buttons: [
                [
                    '<button><i class="fa fa-check"></i> C√≥, x√≥a</button>',
                    function (instance, toast) {
                        instance.hide({ transitionOut: "fadeOut" }, toast, "button");

                        $.ajax({
                            type: "POST",
                            url: "/Admin/DeleteAmenity",
                            data: { id: id },
                            success: function (response) {
                                iziToast.show({
                                    title: response.success ? "‚úÖ ƒê√£ x√≥a!" : "‚ùå L·ªói!",
                                    message: response.message,
                                    position: "topRight",
                                    timeout: 1000,
                                    color: response.success ? "green" : "red"
                                });

                                if (response.success) {
                                    $("#row_" + id).remove();
                                    updateAmenityTable();
                                }
                            }
                        });
                    },
                    true
                ],
                [
                    '<button><i class="fa fa-times"></i> H·ªßy</button>',
                    function (instance, toast) {
                        instance.hide({ transitionOut: "fadeOut" }, toast, "button");
                    }
                ]
            ]
        });
    }

    function updateAmenityTable() {
        $.get("/Admin/ManageAmenities", function (data) {
            let newTableBody = $(data).find("#amenityTableBody").html();
            $("#amenityTableBody").html(newTableBody);
            let rows = $("#amenityTableBody tr");
            rows.each(function (index) {
                $(this).find("td:first").text(index + 1);
            });
        });
    }
</script>
